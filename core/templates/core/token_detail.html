{% extends 'layout.html' %}
{% block title %}{% if token.enabled %}{{ token.name }}{% else %}Not Found{% endif %}{% endblock %}
{% load account %}
{% load socialaccount %}

{% block content %}
{% if token.enabled %}
<h1>{{ token.name }}</h1>
<p>This is the profile page for {{ token.firstname }}.
	{% if request.user %}
	You are authenticated right now as <code>{% user_display request.user %}</code>.
	{% endif %}
</p>

{% if token.user %}
{% get_social_accounts token.user as linked %}
{% endif %}

{% if linked %}
<form method="post" action="{% url 'socialaccount_connections' %}">
	<p>You have linked the Discord account <code>{{ linked.discord.0.get_provider_account }}</code>.
		<input id="id_account_{{ linked.discord.0.id }}" type="hidden" name="account" value="{{ linked.discord.0.id }}" />
		{% csrf_token %}
		<input type="submit" class="inline float-right p-1 my-0 text-xs btn btn-red" id="unlink" value="Unlink"></input>
	</p>
</form>
{% else %}
<p>There is no Discord attached to this token.
	You can <a href="/accounts/discord/login?process=login">link your Discord account</a>.</p>
{% endif %}


<h2>Unique link</h2>
<p class="w-full font-mono text-sm text-center">
	<a href="{{ request.build_absolute_uri }}">{{ request.build_absolute_uri }}</a>
</p>

<p>If you load this URL,
	it will automatically restore all your progress,
	without needing to login.
	Thus, you could bookmark this page for safekeeping.</p>
<h2>Actions</h2>
<div class="flex space-x-1">
	<div class="w-full text-left align-top md:w-1/2">
		<p><a class="btn btn-gray" href="{% url "token-update" token.uuid %}">Change name</a></p>
		<p>Tired of being called the same thing all your life? Refresh now!</p>
	</div>
	<div class="w-full text-left align-top md:w-1/2">
	</div>
</div>
<div class="flex space-x-1">
	<div class="w-full text-left align-top md:w-1/2">
		<form method="post" action="{% url "account_logout" %}">
			{% csrf_token %}
			<input type="submit" class="inline p-2 my-0 btn btn-yellow" id="deltoken" value="Log out of profile"></input>
		</form>
		<p>Like you got a new computer.
			Your progress is still attached to your Discord account.</p>
	</div>
	<div class="w-full text-left align-top md:w-1/2">
		<p><a class="btn btn-red" href="{% url "token-disable" token.uuid %}">Destroy profile</a></p>
		<p>What it sounds like. Irreversible once clicked.</p>
	</div>
</div>

{% else %}
<p>This token is deleted.</p>
{% endif %}

{% endblock %}