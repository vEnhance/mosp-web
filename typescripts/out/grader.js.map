{"version":3,"file":"grader.js","sourceRoot":"","sources":["../src/grader.ts"],"names":[],"mappings":"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","sourcesContent":["import SHA from './sha';\nimport Swal from 'sweetalert2';\nimport err from './ajaxCrash';\n\ndeclare const puzzle_slug: string;\ndeclare const hashes: [hash: string];\n\nconst audio = new Audio('https://github.com/vEnhance/dotfiles/blob/main/noisemaker/S3-fanfare.mp3?raw=true');\naudio.volume = 0.6;\n\n$(function() {\n  // Assign relevant metadata\n  $('#prize').css('display', 'block');\n  let active = false;\n  let target_url = '';\n  let raw_answer = '';\n  function checkAnswer() {\n    raw_answer = String($(\"#answer\").val()!);\n    $(\"#answer\").val(raw_answer.toUpperCase());\n    const answer : string = raw_answer.toUpperCase().replace(/[^A-Z]/g, '');\n    if (answer && !active) {\n      active = true;\n      $(\"#wrong\").hide();\n      $(\"#thinking\").show();\n      $(\"#percent\").css('visibility', 'visible');\n      $(\"#answer\").prop('disabled', true);\n      guessSalt(0, answer);\n    }\n  }\n\n  async function guessSalt(t : number, answer : string) {\n    $(\"#percent\").html(t+\"%\");\n    for (let i = 111*t; i < 111*(t+1); i++) {\n      const g = 'MOSP_LIGHT_NOVEL_' + answer + i;\n      const hash = await SHA(g);\n      if (i == 2498) {\n        console.log(g);\n        console.log(hash);\n      }\n      if (hashes.includes(hash)) {\n        $.post('/ajax', {\n          action : 'guess',\n          guess : answer,\n          salt : i,\n          puzzle_slug : puzzle_slug,\n        }, (result) => {\n          if (!result || !result.correct) {\n            err();\n            return;\n          }\n          if (result.correct == 1) {\n            target_url = result.url;\n          } else if (result.correct > 0) {\n            Swal.fire({\n              title : \"Stay determined...\",\n              text : result.message,\n              icon : 'success',\n            });\n          } else {\n            err();\n          }\n        }, 'json').fail(err);\n      }\n    }\n    if (t < 100) {\n      window.setTimeout(function() { guessSalt(t+1, answer) }, 1);\n    }\n    else {\n      judge();\n    }\n  }\n\n  function judge() {\n    $(\"#thinking\").hide();\n    if (!target_url) {\n      // Incorrect answer\n      $(\"#wrong\").show();\n      window.setTimeout(function() {\n        $(\"#wrong\").css(\"opacity\", \"0\");\n      }, 1000);\n      $(\"#percent\").css('visibility', 'hidden');\n      $(\"#answer\").prop('disabled', false);\n      window.setTimeout(function() {\n        $(\"#wrong\").hide();\n        $(\"#wrong\").css(\"opacity\", \"1\");\n        active = false;\n      }, 4000);\n    } else {\n      window.setTimeout(() => {\n        window.location.replace(target_url);\n      }, 8000);\n      $(\"#correct\").show();\n      $(\"#back\").hide();\n      $(\"#prize\").attr('href', target_url);\n      $(\"#prize\").css('z-index', '100');\n      $(\"body\").addClass('solved');\n      audio.play();\n    }\n    // If first time solving this puzzle, spend 1 patience and log it on Discord\n  }\n\n  $(\"#answer\").val('');\n  $(\"#answer\").on('keyup', function(e) {\n    if (e.key === \"Enter\") {\n      checkAnswer();\n    }\n  });\n});\n"]}