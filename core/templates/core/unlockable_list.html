{% extends 'base.html' %}
{% load extras %}
{% block title %}Chapter {{ round.chapter_number }}:
{{ round.name }}{% endblock %}

{% block leftnav %}
<span id="back" class="navbar">
	{% if round.unlockable.parent %}
	<a class="emoji-link" href="{{ round.unlockable.parent.round.get_absolute_url }}">🗺️</a>
	{% else %}
	<a class="emoji-link" href="{{ round.unlockable.hunt.get_absolute_url}}">🌍</a>
	{% endif %}
	<span class="name">{{ token.firstname }}</span>
	</span>
</span>
{% endblock %}

{% block content %}
<h1>Chapter {{ round.chapter_number }}</h1>
<h3><a href="{{ round.unlockable.get_absolute_url }}">{{ round.name }}</a></h3>
{{ round.round_text|mkd }}

<table class="table">
{% for u in unlockable_list %}
<tr>
	<td>{{ u.icon }}
		<a class="place" href="{{u.get_absolute_url}}">{{ u.name }}</a>
	</td>
	{% if token|has_unlocked:u %}
		{% if u.is_puzzle %}
		<td>
		<a href="{{u.puzzle.get_absolute_url}}">{{u.puzzle.name}}</a>
		</td>
		{% if token|has_solved:u %}
			<td><a href="{{u.puzzle.get_solution_url}}">
				<code>{{ u.puzzle.display_answer }}</code>
			</a></td>
		{% else %}
			<td><em>Not solved</em></td>
		{% endif %}

		{% elif u.is_round %}
		<th colspan="2">
			<a href="{{u.round.get_absolute_url}}">{{u.round.name}}</a>
		</th>
		{% endif %}
	{% elif token|can_unlock:u %}
		<td><em>Unlocked!</em></td>
		<td></td>
	{% else %}
		<td><em>Locked</em></td>
		<td></td>
	{% endif %}
</tr>
{% endfor %}
</table>

{% endblock %}
